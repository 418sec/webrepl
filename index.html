<html>
    <head>
        <title>Node REPL</title>
        <link rel="stylesheet" href="webrepl.css" TYPE="text/css"/>
        <script src="jquery-1.5.min.js" type="text/javascript"></script>
        
        <script type="text/javascript">
            
            var blurbHidden = false;
            
            $(document).ready(function() {
                $('#in').keypress(function(event) {
                    if (event.which == '13') {
                        event.preventDefault();
                        commandEntered();
                    }
                });
                
                $('#clear').width('100px');
                $('#clear').click(function() {
                    clear();
                });
                
                $.get('info', function(data) {
                    $('#header').prepend($("<div>[" + data.pid + '] ' + data.name + "</div>"));
                }, 'json');
                
                $('#in').focus();
            });
            
            function clear() {
                $.post('clear', function(data) {
                    getResponse();
                });
                $('#out').prepend($("<div class='replErr'>[ reset ]</div>"));
            }
            
            function commandEntered() {
                if (! blurbHidden) {
                    $('#blurb').hide();
                    blurbHidden = true;
                }
                var command = $('#in').val();
                $('#out').prepend($("<div class='replIn'>" + command + "</div>"));
                $.post('repl', command, function(data) {
                    $('#in').val('');
                    getResponse();
                }, "text");
            }
            
            function getResponse() {
                $.get('repl', function(resData) {
                    var type = 'replOut';
                    if (resData.match(/.*Error:/)) {
                        type = 'replErr';
                    }
                    $('#out').prepend($("<div class='" + type + "'>" + resData + "</div>"));
                });
            }
            
        </script>
    </head>
    <body>
        <div id="header"></div>
        <table id="input-bar">
            <tr>
                <td style="width:95%"><input id="in" type="text" /></td>
                <td style="width:5%"><span id="clear">^C</span></td>
            </tr>
        </table>
        <div id="main-container">
            <div id="out"><div id="blurb">web-repl: Type commands in the above box to execute in this javascript process.</div></div>
        </div>
    </body>
</html>
